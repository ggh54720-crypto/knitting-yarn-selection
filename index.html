<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>手混線 MIX</title>

<style>
*{ box-sizing:border-box; }
body{
  margin:0;
  font-family: system-ui, sans-serif;
  background:#f2f2f2;
}

/* ===== 上方選線區 ===== */
#home{
  padding:16px;
  padding-bottom:35vh;
}

.yarns{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(110px,1fr));
  gap:14px;
}

.yarn{
  background:#fff;
  border-radius:16px;
  padding:8px;
  text-align:center;
  cursor:pointer;
  box-shadow:0 6px 18px rgba(0,0,0,.08);
  transition:.2s;
}
.yarn:hover{ transform:translateY(-4px); }

.yarn img{
  width:100%;
  border-radius:12px;
}
.yarn input{ display:none; }
.yarn.selected{
  outline:3px solid #ff8f66;
}

/* ===== 底部控制區 ===== */
#control{
  position:fixed;
  bottom:0;
  left:0;
  width:100%;
  height:33vh;
  background:#ddd;
  border-radius:24px 24px 0 0;
  padding:16px;
  box-shadow:0 -10px 30px rgba(0,0,0,.15);
  display:flex;
  flex-direction:column;
  gap:14px;
}

/* slots */
#slots{
  display:grid;
  grid-template-columns:repeat(7,1fr);
  gap:10px;
}

.slot{
  background:#fff;
  border-radius:14px;
  aspect-ratio:1/1;
  display:flex;
  align-items:center;
  justify-content:center;
  box-shadow:0 4px 12px rgba(0,0,0,.12);
  overflow:hidden;
  position:relative;
  cursor:pointer;
}

.slot img{
  width:100%;
  height:100%;
  object-fit:cover;
}

/* slot 移除提示 */
.slot::after{
  content:"×";
  position:absolute;
  top:4px;
  right:6px;
  font-size:18px;
  color:#fff;
  background:rgba(0,0,0,.4);
  width:20px;
  height:20px;
  border-radius:50%;
  display:none;
  align-items:center;
  justify-content:center;
}
.slot:hover::after{ display:flex; }

/* MIX slot */
.slot.mix{
  outline:3px solid #ff8f66;
  cursor:default;
}
.slot.mix::after{ display:none; }

/* MIX loading */
.mix.loading{
  background:linear-gradient(100deg,#eee 40%,#ddd 50%,#eee 60%);
  background-size:200% 100%;
  animation:shimmer 1.2s infinite;
}
@keyframes shimmer{
  to{ background-position:-200% 0; }
}

/* button */
#addCart{
  margin-top:auto;
  padding:14px;
  border:none;
  border-radius:16px;
  font-size:18px;
  background:#ff8f66;
  color:#fff;
  cursor:pointer;
}
#addCart:hover{ opacity:.85; }
</style>
</head>

<body>

<!-- 上方選線 -->
<div id="home">
  <div class="yarns">
    <label class="yarn"><input type="checkbox" value="A"><img src="images/A.jpg"><div>A</div></label>
    <label class="yarn"><input type="checkbox" value="B"><img src="images/B.jpg"><div>B</div></label>
    <label class="yarn"><input type="checkbox" value="C"><img src="images/C.jpg"><div>C</div></label>
    <label class="yarn"><input type="checkbox" value="D"><img src="images/D.jpg"><div>D</div></label>
    <label class="yarn"><input type="checkbox" value="E"><img src="images/E.jpg"><div>E</div></label>
    <label class="yarn"><input type="checkbox" value="F"><img src="images/F.jpg"><div>F</div></label>
  </div>
</div>

<!-- 底部控制區 -->
<div id="control">
  <div id="slots">
    <div class="slot" data-index="0"></div>
    <div class="slot" data-index="1"></div>
    <div class="slot" data-index="2"></div>
    <div class="slot" data-index="3"></div>
    <div class="slot" data-index="4"></div>
    <div class="slot" data-index="5"></div>
    <div class="slot mix"></div>
  </div>

  <button id="addCart">加入購物車</button>
</div>

<script>
const MAX = 6;
let selected = [];

/* 上方選線 */
document.querySelectorAll(".yarn input").forEach(inp=>{
  inp.addEventListener("change",()=>{
    const v = inp.value;

    if(inp.checked){
      if(selected.length >= MAX){
        inp.checked = false;
        return;
      }
      selected.push(v);
      inp.closest(".yarn").classList.add("selected");
    }else{
      selected = selected.filter(x=>x!==v);
      inp.closest(".yarn").classList.remove("selected");
    }
    render();
  });
});

/* slot 點擊移除 */
document.querySelectorAll(".slot").forEach(slot=>{
  slot.addEventListener("click",()=>{
    if(slot.classList.contains("mix")) return;
    const i = slot.dataset.index;
    if(selected[i]){
      const val = selected[i];
      selected.splice(i,1);
      document.querySelector(`.yarn input[value="${val}"]`).checked = false;
      document.querySelector(`.yarn input[value="${val}"]`).closest(".yarn").classList.remove("selected");
      render();
    }
  });
});

function render(){
  const slots = document.querySelectorAll(".slot:not(.mix)");
  slots.forEach((s,i)=>{
    s.innerHTML="";
    if(selected[i]){
      const img = document.createElement("img");
      img.src = `images/${selected[i]}.jpg`;
      s.appendChild(img);
    }
  });

  renderMix();
}

function renderMix(){
  const mixSlot = document.querySelector(".slot.mix");
  mixSlot.innerHTML="";
  mixSlot.classList.remove("loading");

  if(!selected.length) return;

  const key = selected.slice().sort().join("-");
  const img = document.createElement("img");
  mixSlot.classList.add("loading");

  img.onload = ()=>{
    mixSlot.classList.remove("loading");
    img.style.opacity=0;
    mixSlot.appendChild(img);
    requestAnimationFrame(()=>img.style.opacity=1);
  };

  img.onerror = ()=>{
    mixSlot.classList.remove("loading");
    img.src="images/placeholder.jpg";
    mixSlot.appendChild(img);
  };

  img.src = `images/mix/${key}.jpg`;
}

document.getElementById("addCart").onclick=()=>{
  if(!selected.length) return alert("請先選線");
  alert("加入購物車：MIX-" + selected.slice().sort().join("-"));
};
</script>

</body>
</html>
