<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æ‰‹æ··ç·šé…è‰²</title>
<style>
body { font-family:sans-serif; background:#f5f1ea; padding:16px; }
.app { max-width:800px; width:100%; margin:auto; background:#fff; border-radius:20px; padding:16px; }
header { display:flex; justify-content:space-between; align-items:center; margin-bottom:12px; }

.yarns { display:grid; grid-template-columns:repeat(auto-fit, minmax(100px,1fr)); gap:12px; margin-top:12px; }
.yarn { border:2px solid #eee; border-radius:12px; padding:6px; text-align:center; position:relative; cursor:pointer; transition: all 0.2s; }
.yarn:hover { transform: scale(1.05); }
.yarn.selected { border-color:#ff8f66; }
.yarn img { width:100%; border-radius:8px; }

.number-box {
  position:absolute;
  top:4px;
  left:4px;
  width:20px;
  height:20px;
  border-radius:4px;
  background:#ff8f66;
  color:#fff;
  font-size:12px;
  text-align:center;
  line-height:20px;
  display:none;
}

button { padding:10px 14px; border-radius:12px; border:none; font-size:16px; cursor:pointer; transition: all 0.2s; }
button:hover { opacity:0.8; }
.primary { background:#ff8f66; color:#fff; }
.secondary { background:#444; color:#fff; }

/* é è¦½å®¹å™¨ */
#previewContainer { margin-top:20px; text-align:center; }

/* ä¸‹å±¤å›ºå®šä¸»åœ– */
#mainPreview { width:200px; height:200px; margin:auto; border:1px solid #ddd; border-radius:12px; overflow:hidden; margin-bottom:10px; }
#mainPreview img { width:100%; height:100%; object-fit:cover; }

/* ä¸Šå±¤æ»‘å‹•ç¸®åœ– */
#thumbnailSlider { display:flex; overflow-x:auto; gap:6px; padding:6px 0; }
#thumbnailSlider img { width:60px; height:60px; border-radius:8px; cursor:pointer; flex-shrink:0; border:2px solid transparent; transition: all 0.2s; }
#thumbnailSlider img.selected { border-color:#ff8f66; }

#toast {
  position: fixed;
  bottom: 30px;
  left: 50%;
  transform: translateX(-50%);
  background:#444;
  color:#fff;
  padding:12px 20px;
  border-radius:12px;
  opacity:0;
  transition: opacity 0.5s;
  z-index:1000;
}
</style>
</head>
<body>
<div class="app">
<header>
  <h3>ğŸ§¶ æ‰‹æ··ç·š</h3>
  <button type="button" id="cartBtn" onclick="showCart()">ğŸ›’ 0</button>
</header>

<div id="home">
  <input id="search" placeholder="æœå°‹ç·šææˆ–é¡è‰²"
    oninput="filterYarns()"
    style="width:100%;padding:10px;border-radius:10px;border:1px solid #ddd;">

  <div class="yarns">
    <label class="yarn" data-name="å¥¶èŒ¶ç‡•éº¥">
      <div class="number-box"></div>
      <input type="checkbox" value="A">
      <img src="images/A.jpg">
      <div>å¥¶èŒ¶ç‡•éº¥</div>
    </label>

    <label class="yarn" data-name="éœ§è—æµ·é¹½">
      <div class="number-box"></div>
      <input type="checkbox" value="B">
      <img src="images/B.jpg">
      <div>éœ§è—æµ·é¹½</div>
    </label>

    <label class="yarn" data-name="æ£®æ—æ©„æ¬–">
      <div class="number-box"></div>
      <input type="checkbox" value="C">
      <img src="images/C.jpg">
      <div>æ£®æ—æ©„æ¬–</div>
    </label>

    <label class="yarn" data-name="å¤•é™½æ©˜">
      <div class="number-box"></div>
      <input type="checkbox" value="D">
      <img src="images/D.jpg">
      <div>å¤•é™½æ©˜</div>
    </label>

    <label class="yarn" data-name="ç²‰ç´…æ«»èŠ±">
      <div class="number-box"></div>
      <input type="checkbox" value="E">
      <img src="images/E.jpg">
      <div>ç²‰ç´…æ«»èŠ±</div>
    </label>

    <label class="yarn" data-name="å¤©ç©ºè—">
      <div class="number-box"></div>
      <input type="checkbox" value="F">
      <img src="images/F.jpg">
      <div>å¤©ç©ºè—</div>
    </label>
  </div>
</div>

<div id="previewContainer">
  <!-- ä¸‹å±¤å›ºå®šä¸»åœ– -->
  <div id="mainPreview">
    <img id="mainImage" src="images/placeholder.jpg" alt="æ··ç·šé è¦½">
  </div>

  <!-- ä¸Šå±¤æ»‘å‹•ç¸®åœ– -->
  <div id="thumbnailSlider"></div>

  <button type="button" class="primary" onclick="addToCart()">åŠ å…¥è³¼ç‰©è»Š</button>
</div>

<div id="toast"></div>
</div>

<script>
let selectionOrder = [];

// Toast
function showToast(msg){
  const t = document.getElementById("toast");
  t.innerText = msg;
  t.style.opacity = 1;
  setTimeout(()=> t.style.opacity=0, 1500);
}

// æœå°‹
function filterYarns(){
  const k = document.getElementById("search").value.toLowerCase() || "";
  document.querySelectorAll(".yarn").forEach(y=>{
    y.style.display = y.dataset.name.toLowerCase().includes(k) ? "block":"none";
  });
}

// checkbox change ç›£è½
document.querySelectorAll(".yarn input").forEach(inp=>{
  inp.addEventListener("change", ()=>{
    if(inp.checked && selectionOrder.length>=6){
      inp.checked=false;
      showToast("æœ€å¤šåªèƒ½é¸6çµ„ç·šæ");
      return;
    }
    selectionOrder = [...document.querySelectorAll(".yarn input:checked")].map(i=>i.value);
    refreshPreview();
  });
});

function refreshPreview(){
  // æ›´æ–° number-box èˆ‡é«˜äº®
  document.querySelectorAll(".yarn input").forEach(i=>{
    const parent = i.closest(".yarn");
    const box = parent.querySelector(".number-box");
    if(i.checked){
      box.style.display="block";
      box.innerText = selectionOrder.indexOf(i.value)+1;
      parent.classList.add("selected");
    } else {
      box.style.display="none";
      parent.classList.remove("selected");
    }
  });

  // æ›´æ–°ä¸‹å±¤ä¸»åœ–
  const mainImg = document.getElementById("mainImage");
  if(selectionOrder.length===0){
    mainImg.src="images/placeholder.jpg";
  } else {
    mainImg.src=`images/${selectionOrder[0]}.jpg`;
  }

  // æ›´æ–°ä¸Šå±¤æ»‘å‹•ç¸®åœ–
  const slider = document.getElementById("thumbnailSlider");
  slider.innerHTML="";
  selectionOrder.forEach(v=>{
    const img = document.createElement("img");
    img.src=`images/${v}.jpg`;
    img.alt=v;
    img.classList.add("selected");
    img.onerror=()=>img.src="images/placeholder.jpg";
    img.addEventListener("click", ()=>{
      document.querySelector(`.yarn input[value="${v}"]`).checked=false;
      selectionOrder = [...document.querySelectorAll(".yarn input:checked")].map(i=>i.value);
      refreshPreview();
    });
    slider.appendChild(img);
  });
}

// åŠ å…¥è³¼ç‰©è»Š
function addToCart(){
  if(selectionOrder.length===0){ showToast("è«‹å…ˆé¸æ“‡ç·šæ"); return; }
  const cart = JSON.parse(localStorage.getItem("cart")||"[]");
  const key = "MIX-" + selectionOrder.join("-");
  if(!cart.some(item=>item.key===key)){
    cart.push({key:key, combo:[...selectionOrder], timestamp:Date.now()});
  }
  localStorage.setItem("cart",JSON.stringify(cart));
  showToast("å·²åŠ å…¥è³¼ç‰©è»Š");
  updateCartCount();

  // æ¸…ç©ºé¸æ“‡
  document.querySelectorAll(".yarn input").forEach(i=>i.checked=false);
  selectionOrder=[];
  refreshPreview();
}

// æ›´æ–°è³¼ç‰©è»Šæ•¸é‡
function updateCartCount(){
  const cartData = JSON.parse(localStorage.getItem("cart")||"[]");
  document.getElementById("cartBtn").innerText = `ğŸ›’ ${cartData.length}`;
}

updateCartCount();
</script>
</body>
</html>
