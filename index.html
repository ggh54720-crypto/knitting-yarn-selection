<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æ‰‹æ··ç·šé…è‰²</title>

<style>
body { font-family:sans-serif; background:#f5f1ea; padding:16px; }
.app { max-width:420px; margin:auto; background:#fff; border-radius:20px; padding:16px; }
header { display:flex; justify-content:space-between; align-items:center; }

.yarns { display:grid; grid-template-columns:repeat(3,1fr); gap:12px; margin-top:12px; }
.yarn { border:2px solid #eee; border-radius:12px; padding:6px; text-align:center; }
.yarn img { width:100%; border-radius:8px; }

button { width:100%; padding:14px; border-radius:12px; border:none; margin-top:12px; font-size:16px; }
.primary { background:#ff8f66; color:#fff; }
.secondary { background:#444; color:#fff; }

.hidden { display:none; }

.card { border:1px solid #ddd; border-radius:14px; padding:10px; margin-bottom:12px; }
.card img { width:100%; border-radius:10px; }

.row { display:flex; justify-content:space-between; align-items:center; gap:6px; }

.notice {
  background:#fff3cd;
  border:1px solid #ffeeba;
  padding:10px;
  border-radius:10px;
  font-size:14px;
  margin-bottom:12px;
}
</style>
</head>

<body>
<div class="app">

<header>
  <h3>ğŸ§¶ æ‰‹æ··ç·š</h3>
  <button onclick="showCart()">ğŸ›’</button>
</header>

<div id="lineNotice" class="notice hidden">
  LINE å…§å»ºç€è¦½å™¨ç„¡æ³•ä½¿ç”¨è³¼ç‰©è»ŠåŠŸèƒ½ï¼Œè«‹é»å³ä¸Šè§’ã€Œâ‹¯ã€â†’ åœ¨ç€è¦½å™¨ä¸­é–‹å•Ÿ
</div>

<!-- é¦–é  -->
<div id="home">
  <input id="search" placeholder="æœå°‹ç·šæ"
    oninput="filterYarns()"
    style="width:100%;padding:10px;border-radius:10px;border:1px solid #ddd;">

  <div class="yarns">

    <label class="yarn" data-name="å¥¶èŒ¶ç‡•éº¥ ç±³è‰²">
      <input type="checkbox" value="A">
      <img src="images/A.jpg">
      <div>å¥¶èŒ¶ç‡•éº¥</div>
    </label>

    <label class="yarn" data-name="éœ§è—æµ·é¹½ è—è‰²">
      <input type="checkbox" value="B">
      <img src="images/B.jpg">
      <div>éœ§è—æµ·é¹½</div>
    </label>

    <label class="yarn" data-name="æ£®æ—æ©„æ¬– ç¶ è‰²">
      <input type="checkbox" value="C">
      <img src="images/C.jpg">
      <div>æ£®æ—æ©„æ¬–</div>
    </label>

  </div>

  <button class="primary" onclick="makePreview()">ç”¢ç”Ÿæ··ç·šé è¦½</button>
</div>

<!-- é è¦½ -->
<div id="preview" class="hidden">
  <img id="mixImg">
  <p id="mixInfo"></p>

  <button class="primary" onclick="handleAdd()">åŠ å…¥è³¼ç‰©è»Š</button>
  <button class="secondary" onclick="backHome()">å›é¦–é </button>
</div>

<!-- è³¼ç‰©è»Š -->
<div id="cart" class="hidden">
  <h3>è³¼ç‰©è»Š</h3>
  <div id="cartList"></div>
  <button class="secondary" onclick="backHome()">å›é¦–é </button>
</div>

</div>

<script>
/* ===== LINE åµæ¸¬ ===== */
const isLine = navigator.userAgent.includes("Line");
if (isLine) {
  document.getElementById("lineNotice").classList.remove("hidden");
}

/* ===== localStorage ===== */
function getCart() {
  return JSON.parse(localStorage.getItem("cart") || "[]");
}
function saveCart(cart) {
  localStorage.setItem("cart", JSON.stringify(cart));
}

/* ===== ç‹€æ…‹ ===== */
let currentKey = "";
let currentSelected = [];

/* ===== åŠŸèƒ½ ===== */
function filterYarns() {
  const k = search.value.toLowerCase();
  document.querySelectorAll(".yarn").forEach(y => {
    y.style.display = y.dataset.name.toLowerCase().includes(k)
      ? "block" : "none";
  });
}

function makePreview() {
  const selected = [...document.querySelectorAll("input:checked")]
    .map(i => i.value)
    .sort();

  if (!selected.length) {
    alert("è«‹è‡³å°‘é¸ä¸€ç¨®ç·šæ");
    return;
  }

  currentSelected = selected;
  currentKey = "MIX-" + selected.join("-");
  mixImg.src = `images/mix/${selected.join("-")}.jpg`;
  mixInfo.innerText = currentKey;

  home.classList.add("hidden");
  preview.classList.remove("hidden");
}

function backHome() {
  preview.classList.add("hidden");
  cart.classList.add("hidden");
  home.classList.remove("hidden");
}

function handleAdd() {
  if (isLine) {
    alert("è«‹ç”¨ Safari / Chrome é–‹å•Ÿæœ¬é æ‰èƒ½ä½¿ç”¨è³¼ç‰©è»Š");
    return;
  }
  addToCart();
}

function addToCart() {
  const cart = getCart();
  cart.push({ key: currentKey, combo: [...currentSelected] });
  saveCart(cart);
  alert("å·²åŠ å…¥è³¼ç‰©è»Š");
}

function showCart() {
  if (isLine) {
    alert("LINE å…§å»ºç€è¦½å™¨ç„¡æ³•ä½¿ç”¨è³¼ç‰©è»Šï¼Œè«‹æ”¹ç”¨ç€è¦½å™¨é–‹å•Ÿ");
    return;
  }

  home.classList.add("hidden");
  preview.classList.add("hidden");
  cart.classList.remove("hidden");

  cartList.innerHTML = "";
  const cartData = getCart();

  if (!cartData.length) {
    cartList.innerHTML = "<p>è³¼ç‰©è»Šæ˜¯ç©ºçš„</p>";
    return;
  }

  cartData.forEach((item, i) => {
    const div = document.createElement("div");
    div.className = "card";
    div.innerHTML = `
      <div class="row">
        <strong>${item.key}</strong>
        <button onclick="copyCode('${item.key}')">ğŸ“‹</button>
      </div>
      <img src="images/mix/${item.combo.join("-")}.jpg">
      <button onclick="edit(${i})">âœï¸ ä¿®æ”¹é…è‰²</button>
    `;
    cartList.appendChild(div);
  });
}

function copyCode(text) {
  navigator.clipboard.writeText(text);
}

function edit(index) {
  const item = getCart()[index];
  document.querySelectorAll("input[type=checkbox]").forEach(c => c.checked = false);
  item.combo.forEach(v => {
    document.querySelector(`input[value="${v}"]`).checked = true;
  });
  backHome();
}
</script>

</body>
</html>
