<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æ‰‹æ··ç·šé…è‰²</title>

<style>
body { font-family:sans-serif; background:#f5f1ea; padding:16px; }
.app { max-width:800px; width:100%; margin:auto; background:#fff; border-radius:20px; padding:16px; transition: all 0.3s ease; }
header { display:flex; justify-content:space-between; align-items:center; margin-bottom:12px; }

.yarns { display:grid; grid-template-columns:repeat(auto-fit, minmax(100px,1fr)); gap:12px; margin-top:12px; }
.yarn { border:2px solid #eee; border-radius:12px; padding:6px; text-align:center; transition: transform 0.2s, border 0.2s; }
.yarn:hover { transform: scale(1.05); }
.yarn.selected { border-color:#ff8f66; }
.yarn img { width:100%; border-radius:8px; }

button { padding:10px 14px; border-radius:12px; border:none; font-size:16px; cursor:pointer; transition: all 0.2s; }
button:hover { opacity:0.8; }
.primary { background:#ff8f66; color:#fff; }
.secondary { background:#444; color:#fff; }

.hidden { display:none; }
.show { display:block; }

.card { border:1px solid #ddd; border-radius:14px; padding:10px; margin-bottom:12px; transition: all 0.3s; }
.card img { width:100%; border-radius:10px; }

.row { display:flex; align-items:center; gap:6px; }
.row strong { flex:1; }

/* toast æç¤º */
#toast {
  position: fixed;
  bottom: 30px;
  left: 50%;
  transform: translateX(-50%);
  background:#444;
  color:#fff;
  padding:12px 20px;
  border-radius:12px;
  opacity:0;
  transition: opacity 0.5s;
  z-index:1000;
}

/* ä¸‹æ–¹é è¦½å€ + æ»‘å…¥å‹•ç•« */
#previewContainer {
  margin-top:20px;
  border-top:1px solid #ddd;
  padding-top:12px;
  text-align:center;
  transform: translateY(20px);
  opacity: 0;
  transition: transform 0.4s ease, opacity 0.4s ease;
}
#previewContainer.show {
  transform: translateY(0);
  opacity: 1;
}

/* å¤šç¸®åœ–æ»‘å‹• */
#previewSlider {
  display:flex; 
  overflow-x:auto; 
  gap:8px; 
  padding:8px;
}
#previewSlider img {
  width:120px; 
  height:80px; 
  border-radius:8px; 
  cursor:pointer; 
  transition: transform 0.2s, border 0.2s; 
  border:2px solid #eee;
}
#previewSlider img.selected { border-color:#ff8f66; transform:scale(1.05); }

@media (min-width:600px){
  .yarns { grid-template-columns:repeat(3,1fr); }
}
</style>
</head>

<body>
<div class="app">

<header>
  <h3>ğŸ§¶ æ‰‹æ··ç·š</h3>
  <button type="button" id="cartBtn" onclick="showCart()">ğŸ›’ 0</button>
</header>

<div id="home" class="show">
  <input id="search" placeholder="æœå°‹ç·šææˆ–é¡è‰²"
    oninput="filterYarns()"
    style="width:100%;padding:10px;border-radius:10px;border:1px solid #ddd;">

  <div class="yarns">
    <label class="yarn" data-name="å¥¶èŒ¶ç‡•éº¥" data-color="beige">
      <input type="checkbox" value="A">
      <img src="images/A.jpg">
      <div>å¥¶èŒ¶ç‡•éº¥</div>
    </label>

    <label class="yarn" data-name="éœ§è—æµ·é¹½" data-color="blue">
      <input type="checkbox" value="B">
      <img src="images/B.jpg">
      <div>éœ§è—æµ·é¹½</div>
    </label>

    <label class="yarn" data-name="æ£®æ—æ©„æ¬–" data-color="green">
      <input type="checkbox" value="C">
      <img src="images/C.jpg">
      <div>æ£®æ—æ©„æ¬–</div>
    </label>
  </div>

  <button type="button" class="primary" onclick="showPreview()">ç”¢ç”Ÿæ··ç·šé è¦½</button>
</div>

<!-- ä¸‹æ–¹é è¦½å€ -->
<div id="previewContainer" class="hidden">
  <div id="previewSlider"></div>
  <p id="mixInfo"></p>
  <div style="display:flex; gap:8px; justify-content:center; margin-top:8px;">
    <button type="button" class="primary" onclick="addToCart()">åŠ å…¥è³¼ç‰©è»Š</button>
    <button type="button" class="secondary" onclick="cancelPreview()">å–æ¶ˆ</button>
  </div>
</div>

<div id="cart" class="hidden">
  <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:12px;">
    <h3>è³¼ç‰©è»Š</h3>
    <div>
      <button class="secondary" onclick="backHome()">å›é¦–é </button>
      <button class="secondary" onclick="clearCart()">æ¸…ç©ºè³¼ç‰©è»Š</button>
      <button class="secondary" onclick="deleteSelected()">åˆªé™¤é¸å–</button>
    </div>
  </div>
  <div id="cartList"></div>
</div>

<div id="toast"></div>

</div>

<script>
let currentKey = "";
let currentSelected = [];
let savedSelection = []; 

// toast
function showToast(msg){
  const t = document.getElementById("toast");
  t.innerText = msg;
  t.style.opacity=1;
  t.classList.add("show");
  setTimeout(()=>t.style.opacity=0,1500);
}

// filter
function filterYarns() {
  const k = search.value.toLowerCase();
  document.querySelectorAll(".yarn").forEach(y => {
    const name = y.dataset.name.toLowerCase();
    const color = y.dataset.color.toLowerCase();
    y.style.display = (name.includes(k) || color.includes(k)) ? "block" : "none";
  });
}

// é¡¯ç¤ºä¸‹æ–¹é è¦½
function showPreview() {
  const selected = [...document.querySelectorAll("#home input:checked")].map(i => i.value).sort();
  if(!selected.length){ showToast("è«‹è‡³å°‘é¸ä¸€ç¨®ç·šæ"); return; }

  currentSelected = [...selected];
  savedSelection = [...selected];
  currentKey = "MIX-"+selected.join("-");

  const slider = document.getElementById("previewSlider");
  slider.innerHTML="";

  const img = document.createElement("img");
  img.src=`images/mix/${selected.join("-")}.jpg`;
  img.onerror=()=>{ img.src="images/placeholder.jpg"; showToast("è©²æ··ç·šåœ–ç‰‡ä¸å­˜åœ¨"); };
  img.classList.add("selected");
  slider.appendChild(img);

  document.getElementById("mixInfo").innerText=currentKey;

  // é«˜äº®å‹¾é¸
  document.querySelectorAll(".yarn").forEach(y=>{
    const input = y.querySelector("input");
    if(input.checked) y.classList.add("selected");
    else y.classList.remove("selected");
  });

  const preview=document.getElementById("previewContainer");
  preview.classList.remove("hidden");
  setTimeout(()=>preview.classList.add("show"),50);
}

// å–æ¶ˆ
function cancelPreview(){
  const preview=document.getElementById("previewContainer");
  preview.classList.remove("show");
  preview.addEventListener('transitionend',()=>{ preview.classList.add("hidden"); }, {once:true});
  currentSelected=[...savedSelection];

  document.querySelectorAll(".yarn").forEach(y=>y.classList.remove("selected"));
}

// åŠ å…¥è³¼ç‰©è»Š
function addToCart(){
  const cart=JSON.parse(localStorage.getItem("cart")||"[]");
  if(!cart.some(item=>item.key===currentKey)){
    cart.push({key:currentKey, combo:[...currentSelected], timestamp:Date.now()});
    localStorage.setItem("cart",JSON.stringify(cart));
    updateCartCount();
    showToast("å·²åŠ å…¥è³¼ç‰©è»Š");
  } else showToast("æ­¤é…è‰²å·²åœ¨è³¼ç‰©è»Šä¸­");

  const preview=document.getElementById("previewContainer");
  preview.classList.remove("show");
  preview.addEventListener('transitionend',()=>{ preview.classList.add("hidden"); }, {once:true});

  document.querySelectorAll("#home input[type=checkbox]").forEach(c=>c.checked=false);
  currentSelected=[];
  currentKey="";
  document.querySelectorAll(".yarn").forEach(y=>y.classList.remove("selected"));
}

// é«˜äº®å³æ™‚
document.querySelectorAll(".yarn input").forEach(inp=>{
  inp.addEventListener("change",()=>{
    if(inp.checked) inp.closest(".yarn").classList.add("selected");
    else inp.closest(".yarn").classList.remove("selected");
  });
});

// è³¼ç‰©è»Š
function updateCartCount(){
  const cartData=JSON.parse(localStorage.getItem("cart")||"[]");
  document.getElementById("cartBtn").innerText=`ğŸ›’ ${cartData.length}`;
}
function showCart(){
  document.getElementById("home").classList.replace("show","hidden");
  document.getElementById("previewContainer").classList.replace("show","hidden");
  document.getElementById("cart").classList.replace("hidden","show");
  renderCart();
}
function backHome(){
  document.getElementById("home").classList.replace("hidden","show");
  document.getElementById("previewContainer").classList.replace("show","hidden");
  document.getElementById("cart").classList.replace("show","hidden");
}
function renderCart(){
  const cartData=JSON.parse(localStorage.getItem("cart")||"[]").sort((a,b)=>b.timestamp-a.timestamp);
  const cartList=document.getElementById("cartList");
  cartList.innerHTML="";
  cartData.forEach((item,i)=>{
    const div=document.createElement("div");
    div.className="card";
    div.innerHTML=`
      <div class="row">
        <input type="checkbox" data-index="${i}">
        <strong>${item.key}</strong>
        <button type="button" onclick="copyCode('${item.key}')">ğŸ“‹</button>
      </div>
      <img src="images/mix/${item.combo.join("-")}.jpg" onerror="this.src='images/placeholder.jpg'">
      <button type="button" onclick="edit(${i})">ä¿®æ”¹é…è‰²</button>
    `;
    cartList.appendChild(div);
  });
}
function copyCode(text){ navigator.clipboard.writeText(text); showToast("å·²è¤‡è£½ä»£ç¢¼ï¼š"+text); }
function edit(index){
  const cart=JSON.parse(localStorage.getItem("cart")||"[]");
  const item=cart[index];
  document.querySelectorAll("#home input[type=checkbox]").forEach(c=>c.checked=false);
  item.combo.forEach(v=>document.querySelector(`#home input[value="${v}"]`).checked=true);
  cancelPreview();
  document.getElementById("home").classList.replace("hidden","show");
}
function clearCart(){
  if(confirm("ç¢ºå®šè¦æ¸…ç©ºè³¼ç‰©è»Šå—ï¼Ÿ")){
    localStorage.removeItem("cart");
    renderCart();
    updateCartCount();
    showToast("è³¼ç‰©è»Šå·²æ¸…ç©º");
  }
}
function deleteSelected(){
  const cart=JSON.parse(localStorage.getItem("cart")||"[]");
  const checked=[...document.querySelectorAll("#cartList input[type=checkbox]:checked")].map(c=>parseInt(c.dataset.index));
  if(!checked.length){ showToast("è«‹é¸æ“‡è¦åˆªé™¤çš„é …ç›®"); return; }
  const newCart=cart.filter((_,i)=>!checked.includes(i));
  localStorage.setItem("cart",JSON.stringify(newCart));
  renderCart();
  updateCartCount();
  showToast("å·²åˆªé™¤é¸å–é …ç›®");
}

updateCartCount();
</script>
</body>
</html>
