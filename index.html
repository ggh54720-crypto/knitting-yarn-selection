function showPreview() {
  const selected = [...document.querySelectorAll("#home input:checked")]
    .map(i => i.value)
    .sort();
  if (!selected.length) { showToast("請至少選一種線材"); return; }

  currentSelected = [...selected];
  savedSelection = [...selected];
  currentKey = "MIX-" + selected.join("-");

  const slider = document.getElementById("previewSlider");
  slider.innerHTML = "";

  // 假設只顯示一個組合，也可以擴展為多組組合
  const img = document.createElement("img");
  img.src = `images/mix/${selected.join("-")}.jpg`;
  img.onerror = () => { img.src="images/placeholder.jpg"; showToast("該混線圖片不存在"); };
  img.classList.add("selected");
  slider.appendChild(img);

  document.getElementById("mixInfo").innerText = currentKey;

  // 高亮選中線材
  document.querySelectorAll(".yarn").forEach(y=>{
    const input = y.querySelector("input");
    if(input.checked) y.classList.add("selected");
    else y.classList.remove("selected");
  });

  const preview = document.getElementById("previewContainer");
  preview.classList.remove("hidden");
  setTimeout(()=>preview.classList.add("show"),50);
}

// 取消預覽時移除高亮
function cancelPreview(){
  const preview = document.getElementById("previewContainer");
  preview.classList.remove("show");
  preview.addEventListener('transitionend',()=>{ preview.classList.add("hidden"); }, {once:true});
  currentSelected = [...savedSelection];

  document.querySelectorAll(".yarn").forEach(y=>{
    y.classList.remove("selected");
  });
}

// 當首頁勾選變化時即時高亮
document.querySelectorAll(".yarn input").forEach(inp=>{
  inp.addEventListener("change",()=>{
    if(inp.checked) inp.closest(".yarn").classList.add("selected");
    else inp.closest(".yarn").classList.remove("selected");
  });
});
