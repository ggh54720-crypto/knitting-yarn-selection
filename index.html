<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æ‰‹æ··ç·šé…è‰²</title>

<style>
body { font-family:sans-serif; background:#f5f1ea; padding:16px; }
.app { max-width:420px; margin:auto; background:#fff; border-radius:20px; padding:16px; }
header { display:flex; justify-content:space-between; align-items:center; }

.yarns { display:grid; grid-template-columns:repeat(3,1fr); gap:12px; margin-top:12px; }
.yarn { border:2px solid #eee; border-radius:12px; padding:6px; text-align:center; }
.yarn img { width:100%; border-radius:8px; }

button { width:100%; padding:14px; border-radius:12px; border:none; margin-top:12px; font-size:16px; cursor:pointer; }
.primary { background:#ff8f66; color:#fff; }
.secondary { background:#444; color:#fff; }

.hidden { display:none; }

.card { border:1px solid #ddd; border-radius:14px; padding:10px; margin-bottom:12px; }
.card img { width:100%; border-radius:10px; }

.row { display:flex; align-items:center; gap:6px; }
.row strong { flex:1; }
</style>
</head>

<body>
<div class="app">

<header>
  <h3>ğŸ§¶ æ‰‹æ··ç·š</h3>
  <button type="button" id="cartBtn" onclick="showCart()">ğŸ›’ 0</button>
</header>

<!-- é¦–é  -->
<div id="home">
  <input id="search" placeholder="æœå°‹ç·šæ"
    oninput="filterYarns()"
    style="width:100%;padding:10px;border-radius:10px;border:1px solid #ddd;">

  <div class="yarns">

    <label class="yarn" data-name="å¥¶èŒ¶ç‡•éº¥">
      <input type="checkbox" value="A">
      <img src="images/A.jpg">
      <div>å¥¶èŒ¶ç‡•éº¥</div>
    </label>

    <label class="yarn" data-name="éœ§è—æµ·é¹½">
      <input type="checkbox" value="B">
      <img src="images/B.jpg">
      <div>éœ§è—æµ·é¹½</div>
    </label>

    <label class="yarn" data-name="æ£®æ—æ©„æ¬–">
      <input type="checkbox" value="C">
      <img src="images/C.jpg">
      <div>æ£®æ—æ©„æ¬–</div>
    </label>

  </div>

  <button type="button" class="primary" onclick="makePreview()">ç”¢ç”Ÿæ··ç·šé è¦½</button>
</div>

<!-- é è¦½ -->
<div id="preview" class="hidden">
  <img id="mixImg" style="width:100%; border-radius:12px;">
  <p id="mixInfo"></p>

  <button type="button" class="primary" onclick="addToCart()">åŠ å…¥è³¼ç‰©è»Š</button>
  <button type="button" class="secondary" onclick="backHome()">å›é¦–é </button>
</div>

<!-- è³¼ç‰©è»Š -->
<div id="cart" class="hidden">
  <h3>è³¼ç‰©è»Š</h3>
  <div id="cartList"></div>
</div>

</div>

<script>
let currentKey = "";
let currentSelected = [];

// æœå°‹éæ¿¾
function filterYarns() {
  const k = search.value.toLowerCase();
  document.querySelectorAll(".yarn").forEach(y => {
    y.style.display = y.dataset.name.toLowerCase().includes(k) ? "block" : "none";
  });
}

// ç”¢ç”Ÿæ··ç·šé è¦½
function makePreview() {
  const selected = [...document.querySelectorAll("input:checked")]
    .map(i => i.value)
    .sort();

  if (!selected.length) {
    alert("è«‹è‡³å°‘é¸ä¸€ç¨®ç·šæ");
    return;
  }

  currentSelected = selected;
  currentKey = "MIX-" + selected.join("-");

  mixImg.src = `images/mix/${selected.join("-")}.jpg`;
  mixImg.onerror = () => { mixImg.src = "images/placeholder.jpg"; };
  mixInfo.innerText = currentKey;

  home.classList.add("hidden");
  preview.classList.remove("hidden");
}

// å›é¦–é 
function backHome() {
  preview.classList.add("hidden");
  cart.classList.add("hidden");
  home.classList.remove("hidden");
}

// æ›´æ–°è³¼ç‰©è»Šæ•¸é‡
function updateCartCount() {
  const cartData = JSON.parse(localStorage.getItem("cart") || "[]");
  document.getElementById("cartBtn").innerText = `ğŸ›’ ${cartData.length}`;
}

// åŠ å…¥è³¼ç‰©è»Š
function addToCart() {
  const cart = JSON.parse(localStorage.getItem("cart") || "[]");

  // é¿å…é‡è¤‡åŠ å…¥
  if (!cart.some(item => item.key === currentKey)) {
    cart.push({ key: currentKey, combo: currentSelected });
    localStorage.setItem("cart", JSON.stringify(cart));
    updateCartCount();
    alert("å·²åŠ å…¥è³¼ç‰©è»Š");
  } else {
    alert("æ­¤é…è‰²å·²åœ¨è³¼ç‰©è»Šä¸­");
  }
}

// é¡¯ç¤ºè³¼ç‰©è»Š
function showCart() {
  home.classList.add("hidden");
  preview.classList.add("hidden");
  cart.classList.remove("hidden");

  cartList.innerHTML = "";
  const cartData = JSON.parse(localStorage.getItem("cart") || "[]");

  cartData.forEach((item, i) => {
    const div = document.createElement("div");
    div.className = "card";
    div.innerHTML = `
      <div class="row">
        <input type="checkbox">
        <strong>${item.key}</strong>
        <button type="button" onclick="copyCode('${item.key}')">ğŸ“‹</button>
      </div>
      <img src="images/mix/${item.combo.join("-")}.jpg" onerror="this.src='images/placeholder.jpg'">
      <button type="button" onclick="edit(${i})">ä¿®æ”¹é…è‰²</button>
    `;
    cartList.appendChild(div);
  });

  // æ¸…ç©ºè³¼ç‰©è»ŠæŒ‰éˆ•
  const clearBtn = document.createElement("button");
  clearBtn.className = "secondary";
  clearBtn.innerText = "æ¸…ç©ºè³¼ç‰©è»Š";
  clearBtn.onclick = () => {
    if (confirm("ç¢ºå®šè¦æ¸…ç©ºè³¼ç‰©è»Šå—ï¼Ÿ")) {
      localStorage.removeItem("cart");
      cartList.innerHTML = "";
      updateCartCount();
    }
  };
  cartList.appendChild(clearBtn);
}

// è¤‡è£½ä»£ç¢¼
function copyCode(text) {
  navigator.clipboard.writeText(text);
  alert("å·²è¤‡è£½ä»£ç¢¼ï¼š" + text);
}

// ç·¨è¼¯é…è‰²
function edit(index) {
  const cart = JSON.parse(localStorage.getItem("cart") || "[]");
  const item = cart[index];

  document.querySelectorAll("input[type=checkbox]").forEach(c => c.checked = false);
  item.combo.forEach(v => {
    document.querySelector(`input[value="${v}"]`).checked = true;
  });

  backHome();
}

// åˆå§‹åŒ–è³¼ç‰©è»Šæ•¸é‡
updateCartCount();
</script>

</body>
</html>
